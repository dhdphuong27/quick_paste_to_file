<UserControl x:Class="PasteToFile.MVVM.View.ClipboardView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:viewModel="clr-namespace:PasteToFile.MVVM.ViewModel"
             xmlns:Icon="http://metro.mahapps.com/winfx/xaml/iconpacks"
             xmlns:core="clr-namespace:PasteToFile.Core"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             xmlns:diag="clr-namespace:System.Diagnostics;assembly=WindowsBase"
             mc:Ignorable="d"
             d:DesignHeight="640" d:DesignWidth="810"
             d:DataContext="{d:DesignInstance Type=viewModel:ClipboardViewModel}">
    <UserControl.Resources>
        <core:PageComparisonConverter x:Key="PageComparisonConverter"/>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </UserControl.Resources>
    <i:Interaction.Triggers>
        <i:EventTrigger EventName="Loaded">
            <i:InvokeCommandAction Command="{Binding LoadedCommand}" />
        </i:EventTrigger>
    </i:Interaction.Triggers>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Search Box -->
        <StackPanel Grid.Row="0" VerticalAlignment="Center" HorizontalAlignment="Center">
            <TextBlock Text="" 
                      Foreground="{StaticResource DarkText}" 
                      FontSize="20" 
                      FontWeight="Bold"
                      HorizontalAlignment="Center"
                      Margin="0,0,0,20"/>

            <!-- Main Search Bar -->
            <Border Style="{StaticResource SearchContainer}" Width="400">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Search TextBox -->
                    <TextBox x:Name="SearchTextBox"
                            Grid.Column="0"
                            Style="{StaticResource PrimaryTextBox}"
                            Text="{Binding PagedData.SearchText, UpdateSourceTrigger=PropertyChanged}">
                        <TextBox.InputBindings>
                            <KeyBinding Key="Enter" Command="{Binding SearchCommand}"/>
                        </TextBox.InputBindings>
                    </TextBox>

                    <!-- Search Button -->
                    <Button x:Name="SearchButton"
                           Grid.Column="1"
                           Style="{StaticResource SearchButton}"
                           Command="{Binding SearchCommand}"/>
                </Grid>
            </Border>
        </StackPanel>

        <Grid Grid.Row="1" Margin="20,20,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0" Orientation="Horizontal">
                <CheckBox Content="Text" 
                  IsChecked="{Binding PagedData.ShowText}" 
                  Style="{StaticResource DarkCheckBox}"
                  FontSize="14"
                  Margin="0,0,10,10"/>
                <CheckBox Content="Image" 
                  IsChecked="{Binding PagedData.ShowImage}" 
                  Style="{StaticResource DarkCheckBox}"
                  FontSize="14"
                  Margin="0,0,0,10"/>
            </StackPanel>

            <Button Grid.Column="2"
                Command="{Binding OpenFolderCommand}" 
                Content="Open target folder"
                Style="{StaticResource PrimaryButton}"
                Click="Button_Click"/>
            <Button Grid.Column="3"
            Command="{Binding SaveContentCommand}" 
            Content="Quick Paste"
            Style="{StaticResource PrimaryButton}"
             Click="Button_Click"/>
        </Grid>

        <!-- Notification -->
        <!--<TextBlock Grid.Row="1" Text="{Binding TestMsg}" 
                   Style="{DynamicResource NotificationText}" Margin="0,0,0,15"/>-->
        <DataGrid   Grid.Row="2" Style="{DynamicResource DarkDataGrid}"
                    ItemsSource="{Binding PagedData}" 
                    CellStyle="{DynamicResource DarkDataGridCell}"
                    ColumnHeaderStyle="{DynamicResource DarkDataGridColumnHeader}"
                    AutoGenerateColumns="False"
                    CanUserResizeColumns="False"
                    CanUserAddRows="False"
                    IsReadOnly="True"
                    VirtualizingStackPanel.IsVirtualizing="True"
                    VirtualizingStackPanel.VirtualizationMode="Recycling"
                    EnableRowVirtualization="True"
                    EnableColumnVirtualization="True">

            <DataGrid.Columns>
                <!-- Content Column -->
                <DataGridTextColumn Header="Content" Width="326">
                    <DataGridTextColumn.Binding>
                        <Binding Path="PreviewText" Mode="OneWay"/>
                    </DataGridTextColumn.Binding>
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock" BasedOn="{StaticResource CellText}">
                            <Setter Property="TextWrapping" Value="Wrap"/>
                            <Setter Property="Padding" Value="12,6"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>


                <!-- Saved_date Column -->
                <DataGridTextColumn Header="Saved at" Binding="{Binding DateCreated, StringFormat={}{0:HH:mm:ss dd/MM/yyyy}}" Width="150">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock" BasedOn="{StaticResource CellText}">
                            <Setter Property="TextWrapping" Value="Wrap"/>
                            <Setter Property="Padding" Value="12,6"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <!-- Type Column -->
                <DataGridTextColumn Header="Type" Binding="{Binding ContentType}" Width="80">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock" BasedOn="{StaticResource CellText}">
                            <Setter Property="TextWrapping" Value="Wrap"/>
                            <Setter Property="Padding" Value="12,6"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <!-- Status Column -->
                <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="80">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock" BasedOn="{StaticResource CellText}">
                            <Setter Property="TextWrapping" Value="Wrap"/>
                            <Setter Property="Padding" Value="12,6"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <!-- Actions Column -->
                <DataGridTemplateColumn Header="Actions" Width="110">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <Button Command="{Binding DataContext.ViewCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        CommandParameter="{Binding}"
                                        Style="{DynamicResource IconButton}" 
                                        ToolTip="View"
                                        Tag="ViewContent">
                                    <Icon:PackIconMaterial Kind="EyeOutline" Style="{DynamicResource StandardIcon}"/>
                                </Button>
                                <Button Command="{Binding DataContext.CopyCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        CommandParameter="{Binding}"
                                        Style="{DynamicResource IconButton}" 
                                        ToolTip="Copy"
                                        Tag="ContentCopy">
                                    <Icon:PackIconMaterial Kind="ContentCopy" Style="{DynamicResource StandardIcon}"/>
                                </Button>
                                <Button Command="{Binding DataContext.DeleteCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        CommandParameter="{Binding}"
                                        Style="{DynamicResource IconButton}" 
                                        ToolTip="Delete"
                                        Tag="ContentDelete">
                                    <Icon:PackIconMaterial Kind="Delete" Style="{DynamicResource StandardIcon}"/>
                                </Button>
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Pagination -->
        <!-- Pagination -->
        <Border Grid.Row="4" Style="{DynamicResource PaginationBorder}">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                <!-- Progress bar -->
                <!--<TextBlock Text="{Binding IsLoading}" Foreground="Red"/>-->
                <ProgressBar 
                    IsIndeterminate="True"
                    Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}"
                    Height="6"
                    Width="100"
                    Foreground="#6B7280"
                    Margin="0,5,0,0"/>


                <!-- Pagination buttons -->
                <Button Style="{StaticResource PaginationLeftButton}" Command="{Binding LoadPreviousPageCommand}"/>
                <ItemsControl ItemsSource="{Binding Buttons}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel Orientation="Horizontal"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Button Content="{Binding page}"
                            Command="{Binding DataContext.SelectPageCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                            CommandParameter="{Binding}">
                                <Button.Style>
                                    <Style TargetType="Button" BasedOn="{StaticResource PaginationButton}">
                                        <Style.Triggers>
                                            <DataTrigger Value="True">
                                                <DataTrigger.Binding>
                                                    <MultiBinding Converter="{StaticResource PageComparisonConverter}">
                                                        <Binding Path="page"/>
                                                        <Binding Path="DataContext.CurrentPageNumber"
                                                         RelativeSource="{RelativeSource AncestorType=UserControl}"/>
                                                    </MultiBinding>
                                                </DataTrigger.Binding>
                                                <!-- Active page look -->
                                                <Setter Property="Background" Value="#404040"/>
                                                <Setter Property="Foreground" Value="White"/>
                                                <Setter Property="FontWeight" Value="Bold"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
                <Button Style="{StaticResource PaginationRightButton}" Command="{Binding LoadNextPageCommand}"/>
            </StackPanel>
        </Border>



    </Grid>
</UserControl>